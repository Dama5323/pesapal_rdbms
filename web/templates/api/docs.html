{% extends 'base.html' %}

{% block title %}API Documentation - PesaPal RDBMS{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-12">
        <h1 class="h2 mb-0">API Documentation</h1>
        <p class="text-muted">REST API documentation for PesaPal RDBMS</p>
    </div>
</div>

<div class="row">
    <div class="col-md-3">
        <!-- API Navigation -->
        <div class="card dashboard-card mb-4">
            <div class="card-body">
                <h6 class="card-title mb-3">API Endpoints</h6>
                <div class="list-group list-group-flush">
                    <a href="#users" class="list-group-item list-group-item-action">
                        <i class="bi bi-people me-2"></i> Users
                    </a>
                    <a href="#transactions" class="list-group-item list-group-item-action">
                        <i class="bi bi-arrow-left-right me-2"></i> Transactions
                    </a>
                    <a href="#ledger" class="list-group-item list-group-item-action">
                        <i class="bi bi-journal-text me-2"></i> Ledger
                    </a>
                    <a href="#audit" class="list-group-item list-group-item-action">
                        <i class="bi bi-shield-check me-2"></i> Audit
                    </a>
                    <a href="#reports" class="list-group-item list-group-item-action">
                        <i class="bi bi-bar-chart me-2"></i> Reports
                    </a>
                </div>
            </div>
        </div>
        
        <div class="card dashboard-card">
            <div class="card-body">
                <h6 class="card-title mb-3">Quick Info</h6>
                <div class="list-group list-group-flush">
                    <div class="list-group-item">
                        <small class="text-muted">Base URL</small>
                        <div class="fw-bold">http://127.0.0.1:8000/api/</div>
                    </div>
                    <div class="list-group-item">
                        <small class="text-muted">Format</small>
                        <div class="fw-bold">JSON</div>
                    </div>
                    <div class="list-group-item">
                        <small class="text-muted">Authentication</small>
                        <div class="fw-bold">JWT / Session</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <div class="col-md-9">
        <!-- API Documentation Content -->
        <div class="card dashboard-card mb-4">
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    This API documentation is automatically generated from your Django REST Framework endpoints.
                </div>
                
                <!-- Users API -->
                <h4 id="users" class="mb-4">
                    <i class="bi bi-people text-primary me-2"></i> Users API
                </h4>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-2">GET</span>
                        <code class="fs-6">/api/users/</code>
                    </div>
                    <p class="text-muted">List all users</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X GET http://127.0.0.1:8000/api/users/ \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-primary me-2">POST</span>
                        <code class="fs-6">/api/users/register/</code>
                    </div>
                    <p class="text-muted">Register a new user</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X POST http://127.0.0.1:8000/api/users/register/ \
  -H "Content-Type: application/json" \
  -d '{
    "email": "user@example.com",
    "password": "password123",
    "first_name": "John",
    "last_name": "Doe"
  }'</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Transactions API -->
                <h4 id="transactions" class="mb-4 mt-5">
                    <i class="bi bi-arrow-left-right text-primary me-2"></i> Transactions API
                </h4>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-2">GET</span>
                        <code class="fs-6">/api/transactions/</code>
                    </div>
                    <p class="text-muted">List all transactions</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X GET http://127.0.0.1:8000/api/transactions/ \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-primary me-2">POST</span>
                        <code class="fs-6">/api/transactions/create/</code>
                    </div>
                    <p class="text-muted">Create a new transaction</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X POST http://127.0.0.1:8000/api/transactions/create/ \
  -H "Authorization: Bearer {token}" \
  -H "Content-Type: application/json" \
  -d '{
    "amount": 1000.00,
    "currency": "USD",
    "sender_account": "ACC001",
    "receiver_account": "ACC002",
    "description": "Payment for services"
  }'</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Ledger API -->
                <h4 id="ledger" class="mb-4 mt-5">
                    <i class="bi bi-journal-text text-primary me-2"></i> Ledger API
                </h4>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-2">GET</span>
                        <code class="fs-6">/api/ledger/</code>
                    </div>
                    <p class="text-muted">Get all ledger entries</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X GET http://127.0.0.1:8000/api/ledger/ \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-warning me-2">POST</span>
                        <code class="fs-6">/api/ledger/verify/</code>
                    </div>
                    <p class="text-muted">Verify ledger integrity</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X POST http://127.0.0.1:8000/api/ledger/verify/ \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Audit API -->
                <h4 id="audit" class="mb-4 mt-5">
                    <i class="bi bi-shield-check text-primary me-2"></i> Audit API
                </h4>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-2">GET</span>
                        <code class="fs-6">/api/audit/logs/</code>
                    </div>
                    <p class="text-muted">Get audit logs</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X GET http://127.0.0.1:8000/api/audit/logs/ \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Reports API -->
                <h4 id="reports" class="mb-4 mt-5">
                    <i class="bi bi-bar-chart text-primary me-2"></i> Reports API
                </h4>
                
                <div class="api-endpoint mb-4">
                    <div class="d-flex align-items-center mb-2">
                        <span class="badge bg-success me-2">GET</span>
                        <code class="fs-6">/api/reports/transactions/</code>
                    </div>
                    <p class="text-muted">Get transaction reports</p>
                    <div class="card bg-light">
                        <div class="card-body">
                            <pre><code>curl -X GET "http://127.0.0.1:8000/api/reports/transactions/?start_date=2024-01-01&end_date=2024-01-31" \
  -H "Authorization: Bearer {token}"</code></pre>
                        </div>
                    </div>
                </div>
                
                <!-- Try it Out Section -->
                <div class="card dashboard-card mt-5">
                    <div class="card-header">
                        <h5 class="card-title mb-0">
                            <i class="bi bi-terminal me-2"></i> Try It Out
                        </h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label for="apiEndpoint" class="form-label">API Endpoint</label>
                            <div class="input-group">
                                <span class="input-group-text">http://127.0.0.1:8000</span>
                                <input type="text" class="form-control" id="apiEndpoint" 
                                       placeholder="/api/users/" value="/api/users/">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label for="apiMethod" class="form-label">HTTP Method</label>
                            <select class="form-select" id="apiMethod">
                                <option value="GET">GET</option>
                                <option value="POST">POST</option>
                                <option value="PUT">PUT</option>
                                <option value="DELETE">DELETE</option>
                            </select>
                        </div>
                        
                        <div class="mb-3">
                            <label for="apiBody" class="form-label">Request Body (JSON)</label>
                            <textarea class="form-control" id="apiBody" rows="4" 
                                      placeholder='{"key": "value"}'></textarea>
                        </div>
                        
                        <button class="btn btn-primary" onclick="tryApi()">
                            <i class="bi bi-send me-2"></i> Send Request
                        </button>
                        
                        <div id="apiResponse" class="mt-4" style="display: none;">
                            <h6>Response</h6>
                            <div class="card bg-light">
                                <div class="card-body">
                                    <pre id="responseContent" class="mb-0"></pre>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    function tryApi() {
        const endpoint = document.getElementById('apiEndpoint').value;
        const method = document.getElementById('apiMethod').value;
        const body = document.getElementById('apiBody').value;
        
        // Show loading
        const responseDiv = document.getElementById('apiResponse');
        const responseContent = document.getElementById('responseContent');
        responseContent.textContent = 'Sending request...';
        responseDiv.style.display = 'block';
        
        // Prepare request
        const url = 'http://127.0.0.1:8000' + endpoint;
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json'
            }
        };
        
        if (body && (method === 'POST' || method === 'PUT')) {
            try {
                options.body = body;
            } catch (e) {
                responseContent.textContent = 'Invalid JSON in request body';
                return;
            }
        }
        
        // Send request
        fetch(url, options)
            .then(response => response.json())
            .then(data => {
                responseContent.textContent = JSON.stringify(data, null, 2);
            })
            .catch(error => {
                responseContent.textContent = 'Error: ' + error.message;
            });
    }
    
    // Smooth scroll for anchor links
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth'
                });
            }
        });
    });
</script>
{% endblock %}